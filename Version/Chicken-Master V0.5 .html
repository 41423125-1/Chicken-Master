<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çƒ¤é›æº«æ¸¬æ§åˆ¶é¢æ¿</title>
    <script src="https://cdn.jsdelivr.net/npm/brython@3/brython.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/brython@3/brython_stdlib.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Microsoft JhengHei', 'Segoe UI', Arial, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #162447 100%);
            color: #e6e6e6;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            background: rgba(22, 36, 71, 0.95);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .panel {
            display: flex;
            min-height: 700px;
        }
        
        .left-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            border-right: 2px solid #2d4059;
        }
        
        .right-section {
            flex: 1.3;
            display: flex;
            flex-direction: column;
        }
        
        .status-bar {
            background: linear-gradient(135deg, #0f3460 0%, #1f4068 100%);
            padding: 20px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #2d4059;
        }
        
        .app-title {
            font-weight: bold;
            font-size: 1.5rem;
            color: #e43f5a;
        }
        
        .current-time {
            font-size: 1.1rem;
            color: #b8b8b8;
        }
        
        .input-section {
            padding: 30px;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
            margin-bottom: 25px;
        }
        
        label {
            margin-bottom: 12px;
            font-weight: bold;
            color: #e6e6e6;
            font-size: 1.1rem;
        }
        
        input[type="number"] {
            padding: 15px;
            border: 2px solid #2d4059;
            border-radius: 10px;
            font-size: 1.1rem;
            background-color: #0f3460;
            color: #e6e6e6;
            transition: all 0.3s ease;
        }
        
        input[type="number"]:focus {
            border-color: #e43f5a;
            outline: none;
            box-shadow: 0 0 10px rgba(228, 63, 90, 0.3);
        }
        
        .calculate-btn {
            background: linear-gradient(135deg, #e43f5a 0%, #d32f4e 100%);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: bold;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 10px;
            box-shadow: 0 4px 15px rgba(228, 63, 90, 0.3);
        }
        
        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(228, 63, 90, 0.4);
        }
        
        .history-btn {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            padding: 14px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 15px;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }
        
        .history-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
        }
        
        .back-btn {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
            color: white;
            border: none;
            padding: 14px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 15px;
            display: none;
            box-shadow: 0 4px 15px rgba(149, 165, 166, 0.3);
        }
        
        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(149, 165, 166, 0.4);
        }

        /* æ§åˆ¶æŒ‰é’®æ ·å¼ */
        .control-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            padding: 25px;
            border-top: 2px solid #2d4059;
            border-bottom: 2px solid #2d4059;
        }
        
        .control-btn {
            background: rgba(15, 52, 96, 0.7);
            border: 1px solid rgba(45, 64, 89, 0.5);
            border-radius: 10px;
            padding: 18px;
            color: #e6e6e6;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 80px;
        }
        
        .control-btn:hover {
            background: rgba(31, 64, 104, 0.8);
            border-color: rgba(228, 63, 90, 0.5);
            transform: translateY(-2px);
        }
        
        .btn-icon {
            font-size: 1.6rem;
            margin-bottom: 8px;
        }

        /* å›¾æ ‡æ§åˆ¶é¢æ¿æ ·å¼ */
        .icon-panel {
            background: rgba(15, 52, 96, 0.7);
            border-radius: 15px;
            padding: 20px;
            margin: 20px;
            border: 1px solid rgba(45, 64, 89, 0.5);
            flex: 1;
        }

        .icon-panel-title {
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
            color: #e43f5a;
            margin-bottom: 20px;
        }

        .icon-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .icon-item {
            background: rgba(31, 64, 104, 0.8);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(45, 64, 89, 0.5);
        }

        .icon-item:hover {
            transform: translateY(-3px);
            border-color: rgba(228, 63, 90, 0.5);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .icon-item.active {
            border-color: #e43f5a;
            box-shadow: 0 0 20px rgba(228, 63, 90, 0.3);
        }

        .icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
            display: block;
        }

        .icon-name {
            font-size: 1rem;
            font-weight: bold;
            color: #e6e6e6;
        }

        .icon-desc {
            font-size: 0.8rem;
            color: #b8b8b8;
            margin-top: 5px;
        }

        /* å›¾æ ‡é¢œè‰² */
        .icon-monitor { color: #4cd964; }
        .icon-recipe { color: #ff9500; }
        .icon-history { color: #5ac8fa; }
        .icon-settings { color: #ff3b30; }
        
        .temp-display {
            padding: 25px 30px 15px 30px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .temp-title {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.3rem;
            color: #e6e6e6;
            font-weight: bold;
        }
        
        .temp-readings {
            display: flex;
            justify-content: space-between;
            margin-bottom: 25px;
            gap: 15px;
        }
        
        .temp-item {
            text-align: center;
            flex: 1;
            padding: 15px;
            background: rgba(15, 52, 96, 0.7);
            border-radius: 10px;
            border: 1px solid rgba(45, 64, 89, 0.5);
        }
        
        .temp-label {
            font-size: 0.9rem;
            color: #b8b8b8;
            margin-bottom: 8px;
        }
        
        .temp-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #e43f5a;
        }
        
        .temp-unit {
            font-size: 0.9rem;
            color: #b8b8b8;
        }
        
        .temp-chart {
            height: 200px;
            background: rgba(26, 26, 46, 0.8);
            border-radius: 12px;
            padding: 15px;
            position: relative;
            margin-top: 10px;
            border: 1px solid rgba(45, 64, 89, 0.5);
        }
        
        .chart-grid {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            pointer-events: none;
        }
        
        .grid-line {
            border-top: 1px solid rgba(45, 64, 89, 0.5);
            width: 100%;
        }
        
        .y-axis-labels {
            position: absolute;
            left: 8px;
            top: 0;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            font-size: 0.75rem;
            color: #b8b8b8;
        }
        
        .chart-data {
            position: absolute;
            bottom: 15px;
            left: 45px;
            right: 15px;
            height: 160px;
            display: flex;
            align-items: flex-end;
            gap: 4px;
        }
        
        .data-point {
            flex: 1;
            background: linear-gradient(to top, #e43f5a, #ff6b6b);
            border-radius: 3px 3px 0 0;
            transition: height 0.5s ease;
            min-height: 5px;
        }
        
        .x-axis-labels {
            position: absolute;
            bottom: 0;
            left: 45px;
            right: 15px;
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            color: #b8b8b8;
            padding: 5px 0;
        }
        
        .results {
            padding: 20px 25px;
            background: rgba(31, 64, 104, 0.8);
            border-top: 2px solid #2d4059;
            flex: 1;
            overflow-y: auto;
        }
        
        .results h2 {
            color: #e43f5a;
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.3rem;
        }
        
        .result-item {
            margin-bottom: 20px;
            padding: 18px;
            background: rgba(15, 52, 96, 0.7);
            border-radius: 10px;
            border: 1px solid rgba(45, 64, 89, 0.5);
        }
        
        .result-title {
            font-weight: bold;
            color: #e43f5a;
            margin-bottom: 12px;
            font-size: 1.1rem;
            border-bottom: 1px solid rgba(228, 63, 90, 0.3);
            padding-bottom: 8px;
        }
        
        .result-value {
            font-size: 0.95rem;
            line-height: 1.5;
            color: #e6e6e6;
        }
        
        .error {
            color: #ff6b6b;
            margin-top: 12px;
            display: none;
            background: rgba(15, 52, 96, 0.8);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            font-size: 1rem;
            border: 1px solid rgba(255, 107, 107, 0.3);
        }
        
        .marinade-details {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .marinade-item {
            background: rgba(26, 26, 46, 0.8);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid rgba(45, 64, 89, 0.3);
        }
        
        .marinade-name {
            font-size: 0.8rem;
            color: #b8b8b8;
            margin-bottom: 5px;
        }
        
        .marinade-amount {
            font-size: 0.9rem;
            font-weight: bold;
            color: #e6e6e6;
        }
        
        .instructions-box {
            background: rgba(26, 26, 46, 0.8);
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            border-left: 4px solid #e43f5a;
        }
        
        .instructions-content {
            font-size: 0.85rem;
            line-height: 1.5;
            white-space: pre-line;
            color: #e6e6e6;
        }
        
        .history-section {
            display: none;
            padding: 20px 25px;
            background: rgba(31, 64, 104, 0.8);
            border-top: 2px solid #2d4059;
            flex: 1;
            overflow-y: auto;
        }
        
        .history-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .history-item {
            background: rgba(15, 52, 96, 0.7);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 12px;
            border: 1px solid rgba(45, 64, 89, 0.5);
            border-left: 4px solid #3498db;
        }
        
        .history-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .history-date {
            font-weight: bold;
            color: #3498db;
            font-size: 0.85rem;
        }
        
        .history-weight {
            color: #e6e6e6;
            font-size: 1rem;
            font-weight: bold;
        }
        
        .no-history {
            text-align: center;
            color: #b8b8b8;
            font-style: italic;
            padding: 30px;
            font-size: 1rem;
        }
    </style>
</head>
<body onload="brython()">
    <div class="container">
        <div class="panel">
            <div class="left-section">
                <div class="status-bar">
                    <div class="app-title">çƒ¤é›æº«æ¸¬æ§åˆ¶é¢æ¿</div>
                    <div class="current-time" id="current-time">22:10</div>
                </div>
                
                <div class="input-section">
                    <!-- é¸¡é‡é‡è¾“å…¥åŒºåŸŸ -->
                    <div class="input-group">
                        <label for="chicken-weight">é›çš„é‡é‡ (å…¬å…‹):</label>
                        <input type="number" id="chicken-weight" min="500" max="5000" step="100" placeholder="ä¾‹å¦‚: 1500" value="1500">
                    </div>
                    
                    <!-- åŠŸèƒ½æŒ‰é’® -->
                    <button class="calculate-btn" id="calculate-btn">è¨ˆç®—çƒ˜çƒ¤åƒæ•¸</button>
                    <button class="history-btn" id="history-btn">æŸ¥çœ‹æ­·å²è¨˜éŒ„</button>
                    <button class="back-btn" id="back-btn">è¿”å›ä¸»ç•«é¢</button>
                    <div id="error-message" class="error">è«‹è¼¸å…¥æœ‰æ•ˆçš„é›é‡é‡ (500-5000å…¬å…‹)</div>
                </div>

                <!-- æ§åˆ¶æŒ‰é’®åŒºåŸŸ - ç°åœ¨åœ¨ä¸Šé¢ -->
                <div class="control-buttons">
                    <button class="control-btn" id="start-btn">
                        <div class="btn-icon">ğŸ”¥</div>
                        <div>é–‹å§‹çƒ˜çƒ¤</div>
                    </button>
                    <button class="control-btn" id="temp-btn">
                        <div class="btn-icon">ğŸŒ¡ï¸</div>
                        <div>èª¿æ•´æº«åº¦</div>
                    </button>
                    <button class="control-btn" id="timer-btn">
                        <div class="btn-icon">â±ï¸</div>
                        <div>è¨­å®šè¨ˆæ™‚å™¨</div>
                    </button>
                    <button class="control-btn" id="recipe-btn">
                        <div class="btn-icon">ğŸ“‹</div>
                        <div>æŸ¥çœ‹é£Ÿè­œ</div>
                    </button>
                </div>

                <!-- å›¾æ ‡æ§åˆ¶é¢æ¿ - ç°åœ¨åœ¨ä¸‹é¢ -->
                <div class="icon-panel">
                    <div class="icon-panel-title">åŠŸèƒ½é¸å–®</div>
                    <div class="icon-grid">
                        <!-- ç›‘æ§å›¾æ ‡ -->
                        <div class="icon-item active" id="icon-monitor">
                            <span class="icon icon-monitor">ğŸ“Š</span>
                            <div class="icon-name">ç›£æ§</div>
                            <div class="icon-desc">å¯¦æ™‚ç›£æ§ç³»çµ±</div>
                        </div>
                        
                        <!-- é£Ÿè°±å›¾æ ‡ -->
                        <div class="icon-item" id="icon-recipe">
                            <span class="icon icon-recipe">ğŸ“‹</span>
                            <div class="icon-name">é£Ÿè­œ</div>
                            <div class="icon-desc">ç®¡ç†çƒ¹é£ªé£Ÿè­œ</div>
                        </div>
                        
                        <!-- å†å²å›¾æ ‡ -->
                        <div class="icon-item" id="icon-history">
                            <span class="icon icon-history">â±ï¸</span>
                            <div class="icon-name">æ­·å²</div>
                            <div class="icon-desc">æŸ¥çœ‹æ“ä½œè¨˜éŒ„</div>
                        </div>
                        
                        <!-- è®¾ç½®å›¾æ ‡ -->
                        <div class="icon-item" id="icon-settings">
                            <span class="icon icon-settings">âš™ï¸</span>
                            <div class="icon-name">è¨­å®š</div>
                            <div class="icon-desc">ç³»çµ±é…ç½®é¸é …</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="right-section">
                <div class="temp-display">
                    <div class="temp-title">çƒ˜çƒ¤æº«åº¦èˆ‡æ™‚é–“ç›£æ§</div>
                    
                    <div class="temp-readings">
                        <div class="temp-item">
                            <div class="temp-label">ç›®å‰çƒ¤ç®±æº«åº¦</div>
                            <div class="temp-value" id="oven-temp">25</div>
                            <div class="temp-unit">Â°C</div>
                        </div>
                        <div class="temp-item">
                            <div class="temp-label">ç›®æ¨™æº«åº¦</div>
                            <div class="temp-value" id="target-temp">--</div>
                            <div class="temp-unit">Â°C</div>
                        </div>
                        <div class="temp-item">
                            <div class="temp-label">å‰©é¤˜æ™‚é–“</div>
                            <div class="temp-value" id="time-left">--</div>
                            <div class="temp-unit">åˆ†é˜</div>
                        </div>
                    </div>
                    
                    <div class="temp-chart">
                        <div class="chart-grid">
                            <div class="grid-line"></div>
                            <div class="grid-line"></div>
                            <div class="grid-line"></div>
                            <div class="grid-line"></div>
                            <div class="grid-line"></div>
                        </div>
                        
                        <div class="y-axis-labels">
                            <div>250</div>
                            <div>200</div>
                            <div>150</div>
                            <div>100</div>
                            <div>50</div>
                            <div>0</div>
                        </div>
                        
                        <div class="chart-data" id="chart-data"></div>
                        
                        <div class="x-axis-labels">
                            <div>10:00</div>
                            <div>10:15</div>
                            <div>10:30</div>
                            <div>10:45</div>
                            <div>11:00</div>
                        </div>
                    </div>
                </div>
                
                <!-- è®¡ç®—ç»“æœåŒºåŸŸ - åŒ…å«è…Œæ–™é…æ–¹å’Œçƒ˜çƒ¤è¯´æ˜ -->
                <div id="results" class="results">
                    <h2>çƒ˜çƒ¤è¨ˆç®—çµæœ</h2>
                    <div class="result-item">
                        <div class="result-title">é†ƒæ–™é…æ–¹èˆ‡ç”¨é‡</div>
                        <div id="marinade-result" class="result-value">è¼¸å…¥é›çš„é‡é‡ä¸¦é»æ“Šè¨ˆç®—ä»¥æŸ¥çœ‹é†ƒæ–™å»ºè­°</div>
                        <div class="marinade-details" id="marinade-details">
                            <!-- è…Œæ–™è¯¦æƒ…å°†ç”± Brython åŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                    <div class="result-item">
                        <div class="result-title">çƒ˜çƒ¤èªªæ˜</div>
                        <div class="instructions-box">
                            <div id="instructions-result" class="instructions-content">è¨ˆç®—å¾Œå°‡é¡¯ç¤ºè©³ç´°çš„çƒ˜çƒ¤èªªæ˜ï¼ŒåŒ…å«æº«åº¦è¨­å®šã€æ™‚é–“æ§åˆ¶å’Œæº–å‚™æ­¥é©Ÿã€‚</div>
                        </div>
                    </div>
                </div>
                
                <div id="history-section" class="history-section">
                    <h2>çƒ˜çƒ¤æ­·å²è¨˜éŒ„</h2>
                    <div class="history-list" id="history-list">
                        <div class="no-history" id="no-history">å°šç„¡çƒ˜çƒ¤æ­·å²è¨˜éŒ„ã€‚è«‹å…ˆè¨ˆç®—æ‚¨çš„ç¬¬ä¸€å€‹çƒ˜çƒ¤åƒæ•¸ï¼</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="text/python">
        # å¯¼å…¥ Brython æ¨¡å—
        from browser import document, timer, window
        import math
        import random
        from datetime import datetime
        
        # è·å– DOM å…ƒç´ å¼•ç”¨
        oven_temp = document["oven-temp"]
        target_temp = document["target-temp"]
        time_left = document["time-left"]
        current_time = document["current-time"]
        chart_data = document["chart-data"]
        chicken_weight_input = document["chicken-weight"]
        calculate_btn = document["calculate-btn"]
        history_btn = document["history-btn"]
        back_btn = document["back-btn"]
        error_message = document["error-message"]
        results_div = document["results"]
        history_section = document["history-section"]
        history_list = document["history-list"]
        no_history = document["no-history"]
        marinade_result = document["marinade-result"]
        marinade_details = document["marinade-details"]
        instructions_result = document["instructions-result"]
        
        # å›¾æ ‡å…ƒç´ 
        icon_monitor = document["icon-monitor"]
        icon_recipe = document["icon-recipe"]
        icon_history = document["icon-history"]
        icon_settings = document["icon-settings"]
        
        # åˆå§‹åŒ–æ¸©åº¦å˜é‡
        oven_current = 25
        target_current = 0
        time_remaining = 0
        is_roasting = False
        
        # å†å²è®°å½•å­˜å‚¨
        roasting_history = []
        
        # å½“å‰æ¿€æ´»çš„å›¾æ ‡
        active_icon = icon_monitor
        
        def set_active_icon(icon):
            """è®¾ç½®æ¿€æ´»çš„å›¾æ ‡"""
            global active_icon
            
            # ç§»é™¤ä¹‹å‰æ¿€æ´»å›¾æ ‡çš„æ ·å¼
            active_icon.classList.remove("active")
            
            # è®¾ç½®æ–°çš„æ¿€æ´»å›¾æ ‡
            icon.classList.add("active")
            active_icon = icon

        def generate_chart_data():
            """ç”Ÿæˆæ¸©åº¦å›¾è¡¨çš„åˆå§‹æ•°æ®ç‚¹"""
            chart_data.clear()
            
            # ä¸ºå›¾è¡¨ç”Ÿæˆæ•°æ®ç‚¹
            for i in range(5):
                data_point = document.createElement("div")
                data_point.className = "data-point"
                
                if target_current > 0:
                    # æ¨¡æ‹Ÿæ¸©åº¦è¿›å±•
                    progress = min(1.0, (5 - i) / 5 * (oven_current / target_current))
                    height = 20 + (progress * 80)
                else:
                    height = 20 + (i * 15)
                
                data_point.style.height = f"{height}%"
                chart_data <= data_point
        
        def update_time():
            """æ›´æ–°å½“å‰æ—¶é—´æ˜¾ç¤º"""
            now = datetime.now()
            current_time.text = now.strftime("%H:%M")
        
        def update_temperatures():
            """æ›´æ–°æ¸©åº¦æ˜¾ç¤ºå’Œæ¨¡æ‹Ÿæ¸©åº¦å˜åŒ–"""
            global oven_current, time_remaining
            
            if is_roasting and target_current > 0:
                # å¦‚æœæ­£åœ¨çƒ˜çƒ¤ï¼Œé€æ¸å¢åŠ æ¸©åº¦åˆ°ç›®æ ‡æ¸©åº¦
                if oven_current < target_current:
                    oven_current += 2
                elif oven_current > target_current + 5:
                    oven_current -= 1
                
                # æ›´æ–°å‰©ä½™æ—¶é—´
                if time_remaining > 0:
                    time_remaining -= 1
                
                # æ›´æ–°æ˜¾ç¤º
                oven_temp.text = f"{oven_current:.0f}"
                target_temp.text = f"{target_current:.0f}"
                
                if time_remaining > 0:
                    hours = time_remaining // 60
                    minutes = time_remaining % 60
                    if hours > 0:
                        time_left.text = f"{hours}æ™‚ {minutes}åˆ†"
                    else:
                        time_left.text = f"{minutes}åˆ†"
                else:
                    time_left.text = "å®Œæˆï¼"
                    # å®Œæˆåé‡ç½®
                    if oven_current <= 25:
                        reset_roasting()
            
            # æ›´æ–°å›¾è¡¨
            generate_chart_data()
        
        def reset_roasting():
            """é‡ç½®çƒ˜çƒ¤çŠ¶æ€åˆ°åˆå§‹å€¼"""
            global is_roasting, target_current, time_remaining
            is_roasting = False
            target_current = 0
            time_remaining = 0
            oven_temp.text = "25"
            target_temp.text = "--"
            time_left.text = "--"
        
        def calculate_marinade(weight):
            """
            æ ¹æ®é¸¡çš„é‡é‡è®¡ç®—è…Œæ–™é…æ¯”
            """
            # è®¡ç®—è…Œæ–™æ¯”ä¾‹ï¼ˆåŸºäºé¸¡çš„é‡é‡ï¼‰
            salt = round(weight * 0.015, 1)  # ç›ï¼šé‡é‡çš„1.5%
            pepper = round(weight * 0.005, 1)  # é»‘èƒ¡æ¤’ï¼šé‡é‡çš„0.5%
            garlic = math.ceil(weight / 500)  # å¤§è’œï¼šæ¯500å…‹1ç“£
            olive_oil = round(weight * 0.02, 1)  # æ©„æ¦„æ²¹ï¼šé‡é‡çš„2%
            herbs = math.ceil(weight / 1000)  # é¦™è‰ï¼šæ¯1000å…‹1èŒ¶åŒ™
            
            return {
                "salt": salt,
                "pepper": pepper,
                "garlic": garlic,
                "olive_oil": olive_oil,
                "herbs": herbs
            }
        
        def calculate_roasting_temperature(weight):
            """æ ¹æ®é‡é‡è®¡ç®—çƒ˜çƒ¤æ¸©åº¦"""
            if weight <= 1000:
                return 200
            elif weight <= 2000:
                return 190
            else:
                return 180
        
        def calculate_roasting_time(weight):
            """æ ¹æ®é‡é‡è®¡ç®—çƒ˜çƒ¤æ—¶é—´"""
            # è®¡ç®—çƒ˜çƒ¤æ—¶é—´ï¼ˆå¤§çº¦æ¯500å…‹éœ€è¦25åˆ†é’Ÿï¼‰
            base_time = 30  # åŸºç¡€æ—¶é—´
            additional_time = (weight / 500) * 25
            return round(base_time + additional_time)
        
        def create_marinade_details(marinade_data):
            """åˆ›å»ºè…Œæ–™è¯¦æƒ…çš„ç½‘æ ¼æ˜¾ç¤º"""
            marinade_details.clear()
            
            for ingredient, amount in marinade_data.items():
                item = document.createElement("div")
                item.className = "marinade-item"
                
                name = document.createElement("div")
                name.className = "marinade-name"
                name.text = ingredient.replace("_", " ").title()
                
                value = document.createElement("div")
                value.className = "marinade-amount"
                
                if ingredient == "garlic":
                    value.text = f"{amount} ç“£"
                elif ingredient == "olive_oil":
                    value.text = f"{amount} æ¯«å‡"
                elif ingredient == "herbs":
                    value.text = f"{amount} èŒ¶åŒ™"
                else:
                    value.text = f"{amount} å…‹"
                
                item <= name
                item <= value
                marinade_details <= item
        
        def save_to_history(weight, temperature, time, marinade_data):
            """ä¿å­˜è®¡ç®—å‚æ•°åˆ°å†å²è®°å½•"""
            history_entry = {
                "date": datetime.now().strftime("%Y-%m-%d %H:%M"),
                "weight": weight,
                "temperature": temperature,
                "time": time,
                "marinade": marinade_data
            }
            roasting_history.append(history_entry)
            
            # ä¿å­˜åˆ° localStorage
            window.localStorage.setItem("roastingHistory", JSON.stringify(roasting_history))
        
        def load_from_history():
            """ä» localStorage åŠ è½½å†å²è®°å½•"""
            global roasting_history
            try:
                stored_history = window.localStorage.getItem("roastingHistory")
                if stored_history:
                    roasting_history = JSON.parse(stored_history)
            except:
                roasting_history = []
        
        def display_history():
            """æ˜¾ç¤ºå†å²è®°å½•"""
            history_list.clear()
            
            if len(roasting_history) == 0:
                no_history.style.display = "block"
                history_list <= no_history
            else:
                no_history.style.display = "none"
                for entry in reversed(roasting_history):
                    history_item = document.createElement("div")
                    history_item.className = "history-item"
                    
                    header = document.createElement("div")
                    header.className = "history-header"
                    
                    date = document.createElement("div")
                    date.className = "history-date"
                    date.text = entry["date"]
                    
                    weight = document.createElement("div")
                    weight.className = "history-weight"
                    weight.text = f"{entry['weight']}å…‹ é›è‚‰"
                    
                    header <= date
                    header <= weight
                    history_item <= header
                    
                    # æ·»åŠ è¯¦ç»†ä¿¡æ¯
                    details = document.createElement("div")
                    details.style.fontSize = "0.85rem"
                    details.style.marginTop = "8px"
                    details.style.color = "#b8b8b8"
                    details.text = f"æº«åº¦: {entry['temperature']}Â°C | æ™‚é–“: {entry['time']}åˆ†é˜ | é¹½: {entry['marinade']['salt']}g"
                    history_item <= details
                    
                    history_list <= history_item
        
        def show_main_view():
            """æ˜¾ç¤ºä¸»ç”»é¢"""
            results_div.style.display = "block"
            history_section.style.display = "none"
            history_btn.style.display = "block"
            back_btn.style.display = "none"
            set_active_icon(icon_monitor)
        
        def show_history_view():
            """æ˜¾ç¤ºå†å²è®°å½•ç”»é¢"""
            results_div.style.display = "none"
            history_section.style.display = "block"
            history_btn.style.display = "none"
            back_btn.style.display = "block"
            display_history()
            set_active_icon(icon_history)
        
        def calculate_handler(evt):
            """å¤„ç†è®¡ç®—æŒ‰é’®ç‚¹å‡»"""
            global target_current, time_remaining
            
            try:
                weight = float(chicken_weight_input.value)
                
                if weight < 500 or weight > 5000:
                    error_message.style.display = "block"
                    return
                
                # éšè—é”™è¯¯æ¶ˆæ¯
                error_message.style.display = "none"
                
                # è®¡ç®—ç»“æœ
                marinade_data = calculate_marinade(weight)
                temperature = calculate_roasting_temperature(weight)
                time = calculate_roasting_time(weight)
                
                # è®¾å®šç›®æ ‡æ¸©åº¦å’Œæ—¶é—´
                target_current = temperature
                time_remaining = time
                
                # æ›´æ–°æ˜¾ç¤º
                target_temp.text = f"{target_current:.0f}"
                
                hours = time_remaining // 60
                minutes = time_remaining % 60
                if hours > 0:
                    time_left.text = f"{hours}æ™‚ {minutes}åˆ†"
                else:
                    time_left.text = f"{minutes}åˆ†"
                
                # æ˜¾ç¤ºè…Œæ–™ç»“æœ
                marinade_text = f"å°æ–¼ {weight}å…‹ çš„é›è‚‰ï¼Œä½¿ç”¨ä»¥ä¸‹é…æ–™ï¼š"
                marinade_result.text = marinade_text
                
                # åˆ›å»ºè¯¦ç»†çš„è…Œæ–™æ˜¾ç¤º
                create_marinade_details(marinade_data)
                
                # æ˜¾ç¤ºè¯´æ˜
                instructions = f"1. æº–å‚™é†ƒæ–™ï¼šå°‡æ‰€æœ‰é…æ–™æ··åˆå‡å‹»\n2. é†ƒè£½é›è‚‰ï¼šå°‡é†ƒæ–™å‡å‹»å¡—æŠ¹åœ¨é›è‚‰ä¸Šï¼Œé†ƒè£½è‡³å°‘2å°æ™‚ï¼ˆæœ€å¥½éå¤œï¼‰\n3. é ç†±çƒ¤ç®±ï¼šå°‡çƒ¤ç®±é ç†±è‡³ {temperature}Â°C\n4. çƒ˜çƒ¤æ™‚é–“ï¼šå°‡é›è‚‰æ”¾å…¥çƒ¤ç®±ï¼Œçƒ˜çƒ¤ {time} åˆ†é˜\n5. æª¢æŸ¥ç†Ÿåº¦ï¼šä½¿ç”¨æº«åº¦è¨ˆæª¢æŸ¥é›è‚‰å…§éƒ¨æº«åº¦æ˜¯å¦é”åˆ°74Â°C\n6. éœç½®ä¼‘æ¯ï¼šçƒ˜çƒ¤å®Œæˆå¾Œï¼Œè®“é›è‚‰éœç½®10åˆ†é˜å†åˆ‡å¡Šäº«ç”¨"
                instructions_result.text = instructions
                
                # ä¿å­˜åˆ°å†å²è®°å½•
                save_to_history(weight, temperature, time, marinade_data)
                
                # æ›´æ–°å›¾è¡¨
                generate_chart_data()
                
            except ValueError:
                error_message.style.display = "block"
        
        # æŒ‰é’®äº‹ä»¶å¤„ç†
        def start_handler(evt):
            global is_roasting
            if target_current > 0:
                is_roasting = True
                window.alert("é–‹å§‹çƒ˜çƒ¤ï¼çƒ¤ç®±åŠ ç†±ä¸­...")
            else:
                window.alert("è«‹å…ˆè¨ˆç®—çƒ˜çƒ¤åƒæ•¸ï¼")
        
        def temp_handler(evt):
            window.alert("æº«åº¦èª¿æ•´åŠŸèƒ½")
        
        def timer_handler(evt):
            window.alert("è¨ˆæ™‚å™¨è¨­å®šåŠŸèƒ½")
        
        def recipe_handler(evt):
            window.alert("é£Ÿè­œæŸ¥çœ‹åŠŸèƒ½")
        
        def history_handler(evt):
            show_history_view()
        
        def back_handler(evt):
            show_main_view()
        
        # å›¾æ ‡ç‚¹å‡»äº‹ä»¶
        def monitor_handler(evt):
            show_main_view()
            window.alert("é€²å…¥ç›£æ§æ¨¡å¼")
        
        def recipe_icon_handler(evt):
            set_active_icon(icon_recipe)
            window.alert("é€²å…¥é£Ÿè­œç®¡ç†")
        
        def history_icon_handler(evt):
            show_history_view()
        
        def settings_handler(evt):
            set_active_icon(icon_settings)
            window.alert("é€²å…¥ç³»çµ±è¨­å®š")
        
        # ç»‘å®šäº‹ä»¶
        calculate_btn.bind("click", calculate_handler)
        document["start-btn"].bind("click", start_handler)
        document["temp-btn"].bind("click", temp_handler)
        document["timer-btn"].bind("click", timer_handler)
        document["recipe-btn"].bind("click", recipe_handler)
        history_btn.bind("click", history_handler)
        back_btn.bind("click", back_handler)
        
        # å›¾æ ‡äº‹ä»¶ç»‘å®š
        icon_monitor.bind("click", monitor_handler)
        icon_recipe.bind("click", recipe_icon_handler)
        icon_history.bind("click", history_icon_handler)
        icon_settings.bind("click", settings_handler)
        
        # åˆå§‹åŒ–åº”ç”¨
        def initialize():
            generate_chart_data()
            update_time()
            load_from_history()
            # è®¾ç½®å®šæ—¶å™¨
            timer.set_interval(update_temperatures, 1000)  # æ¯ç§’æ›´æ–°
            timer.set_interval(update_time, 30000)  # æ¯30ç§’æ›´æ–°æ—¶é—´
        
        # å¯åŠ¨åº”ç”¨
        initialize()
    </script>
</body>
</html>
