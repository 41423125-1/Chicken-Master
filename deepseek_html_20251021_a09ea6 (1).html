<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çƒ¤é›æº«æ¸¬æ§åˆ¶é¢æ¿</title>
    <script src="https://cdn.jsdelivr.net/npm/brython@3/brython.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/brython@3/brython_stdlib.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Microsoft JhengHei', 'Segoe UI', Arial, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #162447 100%);
            color: #e6e6e6;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            background: rgba(22, 36, 71, 0.95);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .panel {
            display: flex;
            min-height: 700px;
        }
        
        .left-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            border-right: 2px solid #2d4059;
        }
        
        .right-section {
            flex: 1.3;
            display: flex;
            flex-direction: column;
        }
        
        .status-bar {
            background: linear-gradient(135deg, #0f3460 0%, #1f4068 100%);
            padding: 20px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #2d4059;
        }
        
        .app-title {
            font-weight: bold;
            font-size: 1.5rem;
            color: #e43f5a;
        }
        
        .current-time {
            font-size: 1.1rem;
            color: #b8b8b8;
        }
        
        .input-section {
            padding: 30px;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
            margin-bottom: 25px;
        }
        
        label {
            margin-bottom: 12px;
            font-weight: bold;
            color: #e6e6e6;
            font-size: 1.1rem;
        }
        
        input[type="number"] {
            padding: 15px;
            border: 2px solid #2d4059;
            border-radius: 10px;
            font-size: 1.1rem;
            background-color: #0f3460;
            color: #e6e6e6;
            transition: all 0.3s ease;
        }
        
        input[type="number"]:focus {
            border-color: #e43f5a;
            outline: none;
            box-shadow: 0 0 10px rgba(228, 63, 90, 0.3);
        }

        /* é…æ–¹é¸æ“‡å€åŸŸ */
        .recipe-selection {
            margin-bottom: 25px;
        }

        .recipe-title {
            font-weight: bold;
            color: #e6e6e6;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .recipe-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .recipe-btn {
            background: rgba(15, 52, 96, 0.7);
            border: 2px solid #2d4059;
            border-radius: 10px;
            padding: 15px;
            color: #e6e6e6;
            font-size: 0.95rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .recipe-btn:hover {
            background: rgba(31, 64, 104, 0.8);
            border-color: rgba(228, 63, 90, 0.5);
            transform: translateY(-2px);
        }

        .recipe-btn.active {
            background: rgba(228, 63, 90, 0.2);
            border-color: #e43f5a;
            color: #e43f5a;
            box-shadow: 0 0 15px rgba(228, 63, 90, 0.3);
        }

        .recipe-icon {
            font-size: 1.3rem;
            margin-bottom: 5px;
            display: block;
        }
        
        .calculate-btn {
            background: linear-gradient(135deg, #e43f5a 0%, #d32f4e 100%);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: bold;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 10px;
            box-shadow: 0 4px 15px rgba(228, 63, 90, 0.3);
        }
        
        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(228, 63, 90, 0.4);
        }
        
        .history-btn {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            padding: 14px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 15px;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }
        
        .history-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
        }
        
        .back-btn {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
            color: white;
            border: none;
            padding: 14px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 15px;
            display: none;
            box-shadow: 0 4px 15px rgba(149, 165, 166, 0.3);
        }
        
        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(149, 165, 166, 0.4);
        }

        /* æ§åˆ¶æŒ‰é’®æ ·å¼ */
        .control-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            padding: 25px;
            border-top: 2px solid #2d4059;
            border-bottom: 2px solid #2d4059;
        }
        
        .control-btn {
            background: rgba(15, 52, 96, 0.7);
            border: 1px solid rgba(45, 64, 89, 0.5);
            border-radius: 10px;
            padding: 18px;
            color: #e6e6e6;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 80px;
        }
        
        .control-btn:hover {
            background: rgba(31, 64, 104, 0.8);
            border-color: rgba(228, 63, 90, 0.5);
            transform: translateY(-2px);
        }
        
        .btn-icon {
            font-size: 1.6rem;
            margin-bottom: 8px;
        }

        /* å›¾æ ‡æ§åˆ¶é¢æ¿æ ·å¼ */
        .icon-panel {
            background: rgba(15, 52, 96, 0.7);
            border-radius: 15px;
            padding: 20px;
            margin: 20px;
            border: 1px solid rgba(45, 64, 89, 0.5);
            flex: 1;
        }

        .icon-panel-title {
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
            color: #e43f5a;
            margin-bottom: 20px;
        }

        .icon-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .icon-item {
            background: rgba(31, 64, 104, 0.8);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(45, 64, 89, 0.5);
        }

        .icon-item:hover {
            transform: translateY(-3px);
            border-color: rgba(228, 63, 90, 0.5);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .icon-item.active {
            border-color: #e43f5a;
            box-shadow: 0 0 20px rgba(228, 63, 90, 0.3);
        }

        .icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
            display: block;
        }

        .icon-name {
            font-size: 1rem;
            font-weight: bold;
            color: #e6e6e6;
        }

        .icon-desc {
            font-size: 0.8rem;
            color: #b8b8b8;
            margin-top: 5px;
        }

        /* å›¾æ ‡é¢œè‰² */
        .icon-monitor { color: #4cd964; }
        .icon-recipe { color: #ff9500; }
        .icon-history { color: #5ac8fa; }
        .icon-settings { color: #ff3b30; }
        
        .results {
            padding: 20px 25px;
            background: rgba(31, 64, 104, 0.8);
            border-top: 2px solid #2d4059;
            flex: 1;
            overflow-y: auto;
        }
        
        .results h2 {
            color: #e43f5a;
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.3rem;
        }
        
        .result-item {
            margin-bottom: 20px;
            padding: 18px;
            background: rgba(15, 52, 96, 0.7);
            border-radius: 10px;
            border: 1px solid rgba(45, 64, 89, 0.5);
        }
        
        .result-title {
            font-weight: bold;
            color: #e43f5a;
            margin-bottom: 12px;
            font-size: 1.1rem;
            border-bottom: 1px solid rgba(228, 63, 90, 0.3);
            padding-bottom: 8px;
        }
        
        .result-value {
            font-size: 0.95rem;
            line-height: 1.5;
            color: #e6e6e6;
        }
        
        .error {
            color: #ff6b6b;
            margin-top: 12px;
            display: none;
            background: rgba(15, 52, 96, 0.8);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            font-size: 1rem;
            border: 1px solid rgba(255, 107, 107, 0.3);
        }
        
        .marinade-details {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .marinade-item {
            background: rgba(26, 26, 46, 0.8);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid rgba(45, 64, 89, 0.3);
        }
        
        .marinade-name {
            font-size: 0.8rem;
            color: #b8b8b8;
            margin-bottom: 5px;
        }
        
        .marinade-amount {
            font-size: 0.9rem;
            font-weight: bold;
            color: #e6e6e6;
        }
        
        .instructions-box {
            background: rgba(26, 26, 46, 0.8);
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            border-left: 4px solid #e43f5a;
        }
        
        .instructions-content {
            font-size: 0.85rem;
            line-height: 1.5;
            white-space: pre-line;
            color: #e6e6e6;
        }
        
        .history-section {
            display: none;
            padding: 20px 25px;
            background: rgba(31, 64, 104, 0.8);
            border-top: 2px solid #2d4059;
            flex: 1;
            overflow-y: auto;
        }
        
        .history-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .history-item {
            background: rgba(15, 52, 96, 0.7);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 12px;
            border: 1px solid rgba(45, 64, 89, 0.5);
            border-left: 4px solid #3498db;
        }
        
        .history-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .history-date {
            font-weight: bold;
            color: #3498db;
            font-size: 0.85rem;
        }
        
        .history-weight {
            color: #e6e6e6;
            font-size: 1rem;
            font-weight: bold;
        }
        
        .no-history {
            text-align: center;
            color: #b8b8b8;
            font-style: italic;
            padding: 30px;
            font-size: 1rem;
        }
    </style>
</head>
<body onload="brython()">
    <div class="container">
        <div class="panel">
            <div class="left-section">
                <div class="status-bar">
                    <div class="app-title">çƒ¤é›æº«æ¸¬æ§åˆ¶é¢æ¿</div>
                    <div class="current-time" id="current-time">22:10</div>
                </div>
                
                <div class="input-section">
                    <!-- é¸¡é‡é‡è¾“å…¥åŒºåŸŸ -->
                    <div class="input-group">
                        <label for="chicken-weight">é›çš„é‡é‡ (å…¬å…‹):</label>
                        <input type="number" id="chicken-weight" min="500" max="5000" step="100" placeholder="ä¾‹å¦‚: 1500" value="1500">
                    </div>

                    <!-- é…æ–¹é¸æ“‡å€åŸŸ -->
                    <div class="recipe-selection">
                        <div class="recipe-title">é¸æ“‡é†ƒæ–™é…æ–¹</div>
                        <div class="recipe-buttons">
                            <button class="recipe-btn active" id="recipe-classic">
                                <span class="recipe-icon">ğŸ—</span>
                                ç¶“å…¸åŸå‘³
                            </button>
                            <button class="recipe-btn" id="recipe-spicy">
                                <span class="recipe-icon">ğŸŒ¶ï¸</span>
                                é¦™è¾£é¢¨å‘³
                            </button>
                            <button class="recipe-btn" id="recipe-herbal">
                                <span class="recipe-icon">ğŸŒ¿</span>
                                é¦™è‰è’œé¦™
                            </button>
                            <button class="recipe-btn" id="recipe-sweet">
                                <span class="recipe-icon">ğŸ¯</span>
                                èœœæ±ç”œå‘³
                            </button>
                        </div>
                    </div>
                    
                    <!-- åŠŸèƒ½æŒ‰é’® -->
                    <button class="calculate-btn" id="calculate-btn">è¨ˆç®—çƒ˜çƒ¤åƒæ•¸</button>
                    <button class="history-btn" id="history-btn">æŸ¥çœ‹æ­·å²è¨˜éŒ„</button>
                    <button class="back-btn" id="back-btn">è¿”å›ä¸»ç•«é¢</button>
                    <div id="error-message" class="error">è«‹è¼¸å…¥æœ‰æ•ˆçš„é›é‡é‡ (500-5000å…¬å…‹)</div>
                </div>

                <!-- æ§åˆ¶æŒ‰é’®åŒºåŸŸ -->
                <div class="control-buttons">
                    <button class="control-btn" id="start-btn">
                        <div class="btn-icon">ğŸ”¥</div>
                        <div>é–‹å§‹çƒ˜çƒ¤</div>
                    </button>
                    <button class="control-btn" id="temp-btn">
                        <div class="btn-icon">ğŸŒ¡ï¸</div>
                        <div>èª¿æ•´æº«åº¦</div>
                    </button>
                    <button class="control-btn" id="timer-btn">
                        <div class="btn-icon">â±ï¸</div>
                        <div>è¨­å®šè¨ˆæ™‚å™¨</div>
                    </button>
                    <button class="control-btn" id="recipe-btn">
                        <div class="btn-icon">ğŸ“‹</div>
                        <div>æŸ¥çœ‹é£Ÿè­œ</div>
                    </button>
                </div>

                <!-- å›¾æ ‡æ§åˆ¶é¢æ¿ -->
                <div class="icon-panel">
                    <div class="icon-panel-title">åŠŸèƒ½é¸å–®</div>
                    <div class="icon-grid">
                        <!-- ç›‘æ§å›¾æ ‡ -->
                        <div class="icon-item active" id="icon-monitor">
                            <span class="icon icon-monitor">ğŸ“Š</span>
                            <div class="icon-name">ç›£æ§</div>
                            <div class="icon-desc">å¯¦æ™‚ç›£æ§ç³»çµ±</div>
                        </div>
                        
                        <!-- é£Ÿè°±å›¾æ ‡ -->
                        <div class="icon-item" id="icon-recipe">
                            <span class="icon icon-recipe">ğŸ“‹</span>
                            <div class="icon-name">é£Ÿè­œ</div>
                            <div class="icon-desc">ç®¡ç†çƒ¹é£ªé£Ÿè­œ</div>
                        </div>
                        
                        <!-- å†å²å›¾æ ‡ -->
                        <div class="icon-item" id="icon-history">
                            <span class="icon icon-history">â±ï¸</span>
                            <div class="icon-name">æ­·å²</div>
                            <div class="icon-desc">æŸ¥çœ‹æ“ä½œè¨˜éŒ„</div>
                        </div>
                        
                        <!-- è®¾ç½®å›¾æ ‡ -->
                        <div class="icon-item" id="icon-settings">
                            <span class="icon icon-settings">âš™ï¸</span>
                            <div class="icon-name">è¨­å®š</div>
                            <div class="icon-desc">ç³»çµ±é…ç½®é¸é …</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="right-section">
                <!-- è®¡ç®—ç»“æœåŒºåŸŸ - åŒ…å«è…Œæ–™é…æ–¹å’Œçƒ˜çƒ¤è¯´æ˜ -->
                <div id="results" class="results">
                    <h2>çƒ˜çƒ¤è¨ˆç®—çµæœ</h2>
                    <div class="result-item">
                        <div class="result-title">é†ƒæ–™é…æ–¹èˆ‡ç”¨é‡</div>
                        <div id="marinade-result" class="result-value">è¼¸å…¥é›çš„é‡é‡ä¸¦é»æ“Šè¨ˆç®—ä»¥æŸ¥çœ‹é†ƒæ–™å»ºè­°</div>
                        <div class="marinade-details" id="marinade-details">
                            <!-- è…Œæ–™è¯¦æƒ…å°†ç”± Brython åŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                    <div class="result-item">
                        <div class="result-title">çƒ˜çƒ¤èªªæ˜</div>
                        <div class="instructions-box">
                            <div id="instructions-result" class="instructions-content">è¨ˆç®—å¾Œå°‡é¡¯ç¤ºè©³ç´°çš„çƒ˜çƒ¤èªªæ˜ï¼ŒåŒ…å«æº«åº¦è¨­å®šã€æ™‚é–“æ§åˆ¶å’Œæº–å‚™æ­¥é©Ÿã€‚</div>
                        </div>
                    </div>
                </div>
                
                <div id="history-section" class="history-section">
                    <h2>çƒ˜çƒ¤æ­·å²è¨˜éŒ„</h2>
                    <div class="history-list" id="history-list">
                        <div class="no-history" id="no-history">å°šç„¡çƒ˜çƒ¤æ­·å²è¨˜éŒ„ã€‚è«‹å…ˆè¨ˆç®—æ‚¨çš„ç¬¬ä¸€å€‹çƒ˜çƒ¤åƒæ•¸ï¼</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="text/python">
        # å¯¼å…¥ Brython æ¨¡å—
        from browser import document, timer, window
        import math
        import random
        from datetime import datetime
        
        # è·å– DOM å…ƒç´ å¼•ç”¨
        current_time = document["current-time"]
        chicken_weight_input = document["chicken-weight"]
        calculate_btn = document["calculate-btn"]
        history_btn = document["history-btn"]
        back_btn = document["back-btn"]
        error_message = document["error-message"]
        results_div = document["results"]
        history_section = document["history-section"]
        history_list = document["history-list"]
        no_history = document["no-history"]
        marinade_result = document["marinade-result"]
        marinade_details = document["marinade-details"]
        instructions_result = document["instructions-result"]
        
        # é…æ–¹æŒ‰é’®
        recipe_classic = document["recipe-classic"]
        recipe_spicy = document["recipe-spicy"]
        recipe_herbal = document["recipe-herbal"]
        recipe_sweet = document["recipe-sweet"]
        
        # å›¾æ ‡å…ƒç´ 
        icon_monitor = document["icon-monitor"]
        icon_recipe = document["icon-recipe"]
        icon_history = document["icon-history"]
        icon_settings = document["icon-settings"]
        
        # å†å²è®°å½•å­˜å‚¨
        roasting_history = []
        
        # å½“å‰æ¿€æ´»çš„å›¾æ ‡
        active_icon = icon_monitor
        
        # å½“å‰é€‰æ‹©çš„é…æ–¹
        current_recipe = "classic"
        
        def set_active_icon(icon):
            """è®¾ç½®æ¿€æ´»çš„å›¾æ ‡"""
            global active_icon
            
            # ç§»é™¤ä¹‹å‰æ¿€æ´»å›¾æ ‡çš„æ ·å¼
            active_icon.classList.remove("active")
            
            # è®¾ç½®æ–°çš„æ¿€æ´»å›¾æ ‡
            icon.classList.add("active")
            active_icon = icon

        def set_active_recipe(recipe_id):
            """è®¾ç½®æ¿€æ´»çš„é…æ–¹"""
            global current_recipe
            
            # ç§»é™¤æ‰€æœ‰é…æ–¹çš„æ¿€æ´»æ ·å¼
            recipe_classic.classList.remove("active")
            recipe_spicy.classList.remove("active")
            recipe_herbal.classList.remove("active")
            recipe_sweet.classList.remove("active")
            
            # è®¾ç½®æ–°çš„æ¿€æ´»é…æ–¹
            if recipe_id == "classic":
                recipe_classic.classList.add("active")
                current_recipe = "classic"
            elif recipe_id == "spicy":
                recipe_spicy.classList.add("active")
                current_recipe = "spicy"
            elif recipe_id == "herbal":
                recipe_herbal.classList.add("active")
                current_recipe = "herbal"
            elif recipe_id == "sweet":
                recipe_sweet.classList.add("active")
                current_recipe = "sweet"

        def update_time():
            """æ›´æ–°å½“å‰æ—¶é—´æ˜¾ç¤º"""
            now = datetime.now()
            current_time.text = now.strftime("%H:%M")
        
        def calculate_marinade(weight, recipe_type):
            """
            æ ¹æ®é¸¡çš„é‡é‡å’Œé…æ–¹ç±»å‹è®¡ç®—è…Œæ–™é…æ¯”
            """
            if recipe_type == "classic":
                # ç¶“å…¸åŸå‘³é…æ–¹
                return {
                    "salt": round(weight * 0.015, 1),  # é¹½ï¼šé‡é‡çš„1.5%
                    "pepper": round(weight * 0.005, 1),  # é»‘èƒ¡æ¤’ï¼šé‡é‡çš„0.5%
                    "garlic": math.ceil(weight / 500),  # å¤§è’œï¼šæ¯500å…‹1ç“£
                    "olive_oil": round(weight * 0.02, 1),  # æ©„æ¬–æ²¹ï¼šé‡é‡çš„2%
                    "herbs": math.ceil(weight / 1000)  # é¦™è‰ï¼šæ¯1000å…‹1èŒ¶åŒ™
                }
            elif recipe_type == "spicy":
                # é¦™è¾£é¢¨å‘³é…æ–¹
                return {
                    "salt": round(weight * 0.012, 1),  # é¹½ï¼šé‡é‡çš„1.2%
                    "pepper": round(weight * 0.008, 1),  # é»‘èƒ¡æ¤’ï¼šé‡é‡çš„0.8%
                    "garlic": math.ceil(weight / 400),  # å¤§è’œï¼šæ¯400å…‹1ç“£
                    "olive_oil": round(weight * 0.018, 1),  # æ©„æ¬–æ²¹ï¼šé‡é‡çš„1.8%
                    "chili_powder": round(weight * 0.003, 1),  # è¾£æ¤’ç²‰ï¼šé‡é‡çš„0.3%
                    "paprika": round(weight * 0.002, 1),  # ç´…æ¤’ç²‰ï¼šé‡é‡çš„0.2%
                    "cumin": round(weight * 0.001, 1)  # å­œç„¶ï¼šé‡é‡çš„0.1%
                }
            elif recipe_type == "herbal":
                # é¦™è‰è’œé¦™é…æ–¹
                return {
                    "salt": round(weight * 0.014, 1),  # é¹½ï¼šé‡é‡çš„1.4%
                    "pepper": round(weight * 0.004, 1),  # é»‘èƒ¡æ¤’ï¼šé‡é‡çš„0.4%
                    "garlic": math.ceil(weight / 300),  # å¤§è’œï¼šæ¯300å…‹1ç“£
                    "olive_oil": round(weight * 0.025, 1),  # æ©„æ¬–æ²¹ï¼šé‡é‡çš„2.5%
                    "rosemary": math.ceil(weight / 800),  # è¿·è¿­é¦™ï¼šæ¯800å…‹1èŒ¶åŒ™
                    "thyme": math.ceil(weight / 800),  # ç™¾é‡Œé¦™ï¼šæ¯800å…‹1èŒ¶åŒ™
                    "lemon_juice": round(weight * 0.01, 1)  # æª¸æª¬æ±ï¼šé‡é‡çš„1%
                }
            elif recipe_type == "sweet":
                # èœœæ±ç”œå‘³é…æ–¹
                return {
                    "salt": round(weight * 0.01, 1),  # é¹½ï¼šé‡é‡çš„1%
                    "pepper": round(weight * 0.003, 1),  # é»‘èƒ¡æ¤’ï¼šé‡é‡çš„0.3%
                    "garlic": math.ceil(weight / 600),  # å¤§è’œï¼šæ¯600å…‹1ç“£
                    "olive_oil": round(weight * 0.015, 1),  # æ©„æ¬–æ²¹ï¼šé‡é‡çš„1.5%
                    "honey": round(weight * 0.03, 1),  # èœ‚èœœï¼šé‡é‡çš„3%
                    "soy_sauce": round(weight * 0.02, 1),  # é†¬æ²¹ï¼šé‡é‡çš„2%
                    "ginger": round(weight * 0.002, 1)  # è–‘ï¼šé‡é‡çš„0.2%
                }
        
        def calculate_roasting_temperature(weight):
            """æ ¹æ®é‡é‡è®¡ç®—çƒ˜çƒ¤æ¸©åº¦"""
            if weight <= 1000:
                return 200
            elif weight <= 2000:
                return 190
            else:
                return 180
        
        def calculate_roasting_time(weight):
            """æ ¹æ®é‡é‡è®¡ç®—çƒ˜çƒ¤æ—¶é—´"""
            # è®¡ç®—çƒ˜çƒ¤æ—¶é—´ï¼ˆå¤§çº¦æ¯500å…‹éœ€è¦25åˆ†é’Ÿï¼‰
            base_time = 30  # åŸºç¡€æ—¶é—´
            additional_time = (weight / 500) * 25
            return round(base_time + additional_time)
        
        def create_marinade_details(marinade_data):
            """åˆ›å»ºè…Œæ–™è¯¦æƒ…çš„ç½‘æ ¼æ˜¾ç¤º"""
            marinade_details.clear()
            
            for ingredient, amount in marinade_data.items():
                item = document.createElement("div")
                item.className = "marinade-item"
                
                name = document.createElement("div")
                name.className = "marinade-name"
                name.text = ingredient.replace("_", " ").title()
                
                value = document.createElement("div")
                value.className = "marinade-amount"
                
                if ingredient == "garlic":
                    value.text = f"{amount} ç“£"
                elif ingredient in ["olive_oil", "lemon_juice", "soy_sauce"]:
                    value.text = f"{amount} æ¯«å‡"
                elif ingredient in ["herbs", "rosemary", "thyme"]:
                    value.text = f"{amount} èŒ¶åŒ™"
                elif ingredient == "honey":
                    value.text = f"{amount} å…‹"
                else:
                    value.text = f"{amount} å…‹"
                
                item <= name
                item <= value
                marinade_details <= item
        
        def save_to_history(weight, temperature, time, marinade_data, recipe_type):
            """ä¿å­˜è®¡ç®—å‚æ•°åˆ°å†å²è®°å½•"""
            recipe_names = {
                "classic": "ç¶“å…¸åŸå‘³",
                "spicy": "é¦™è¾£é¢¨å‘³", 
                "herbal": "é¦™è‰è’œé¦™",
                "sweet": "èœœæ±ç”œå‘³"
            }
            
            history_entry = {
                "date": datetime.now().strftime("%Y-%m-%d %H:%M"),
                "weight": weight,
                "temperature": temperature,
                "time": time,
                "marinade": marinade_data,
                "recipe_type": recipe_type,
                "recipe_name": recipe_names[recipe_type]
            }
            roasting_history.append(history_entry)
            
            # ä¿å­˜åˆ° localStorage
            window.localStorage.setItem("roastingHistory", JSON.stringify(roasting_history))
        
        def load_from_history():
            """ä» localStorage åŠ è½½å†å²è®°å½•"""
            global roasting_history
            try:
                stored_history = window.localStorage.getItem("roastingHistory")
                if stored_history:
                    roasting_history = JSON.parse(stored_history)
            except:
                roasting_history = []
        
        def display_history():
            """æ˜¾ç¤ºå†å²è®°å½•"""
            history_list.clear()
            
            if len(roasting_history) == 0:
                no_history.style.display = "block"
                history_list <= no_history
            else:
                no_history.style.display = "none"
                for entry in reversed(roasting_history):
                    history_item = document.createElement("div")
                    history_item.className = "history-item"
                    
                    header = document.createElement("div")
                    header.className = "history-header"
                    
                    date = document.createElement("div")
                    date.className = "history-date"
                    date.text = entry["date"]
                    
                    weight = document.createElement("div")
                    weight.className = "history-weight"
                    weight.text = f"{entry['weight']}å…‹ é›è‚‰ - {entry['recipe_name']}"
                    
                    header <= date
                    header <= weight
                    history_item <= header
                    
                    # æ·»åŠ è¯¦ç»†ä¿¡æ¯
                    details = document.createElement("div")
                    details.style.fontSize = "0.85rem"
                    details.style.marginTop = "8px"
                    details.style.color = "#b8b8b8"
                    details.text = f"æº«åº¦: {entry['temperature']}Â°C | æ™‚é–“: {entry['time']}åˆ†é˜"
                    history_item <= details
                    
                    history_list <= history_item
        
        def show_main_view():
            """æ˜¾ç¤ºä¸»ç”»é¢"""
            results_div.style.display = "block"
            history_section.style.display = "none"
            history_btn.style.display = "block"
            back_btn.style.display = "none"
            set_active_icon(icon_monitor)
        
        def show_history_view():
            """æ˜¾ç¤ºå†å²è®°å½•ç”»é¢"""
            results_div.style.display = "none"
            history_section.style.display = "block"
            history_btn.style.display = "none"
            back_btn.style.display = "block"
            display_history()
            set_active_icon(icon_history)
        
        def calculate_handler(evt):
            """å¤„ç†è®¡ç®—æŒ‰é’®ç‚¹å‡»"""
            try:
                weight = float(chicken_weight_input.value)
                
                if weight < 500 or weight > 5000:
                    error_message.style.display = "block"
                    return
                
                # éšè—é”™è¯¯æ¶ˆæ¯
                error_message.style.display = "none"
                
                # è®¡ç®—ç»“æœ
                marinade_data = calculate_marinade(weight, current_recipe)
                temperature = calculate_roasting_temperature(weight)
                time = calculate_roasting_time(weight)
                
                # æ˜¾ç¤ºè…Œæ–™ç»“æœ
                recipe_names = {
                    "classic": "ç¶“å…¸åŸå‘³",
                    "spicy": "é¦™è¾£é¢¨å‘³",
                    "herbal": "é¦™è‰è’œé¦™", 
                    "sweet": "èœœæ±ç”œå‘³"
                }
                
                marinade_text = f"å°æ–¼ {weight}å…‹ çš„é›è‚‰ï¼Œä½¿ç”¨ {recipe_names[current_recipe]} é…æ–¹ï¼š"
                marinade_result.text = marinade_text
                
                # åˆ›å»ºè¯¦ç»†çš„è…Œæ–™æ˜¾ç¤º
                create_marinade_details(marinade_data)
                
                # æ˜¾ç¤ºè¯´æ˜
                instructions = f"1. æº–å‚™é†ƒæ–™ï¼šå°‡æ‰€æœ‰é…æ–™æ··åˆå‡å‹»\n2. é†ƒè£½é›è‚‰ï¼šå°‡é†ƒæ–™å‡å‹»å¡—æŠ¹åœ¨é›è‚‰ä¸Šï¼Œé†ƒè£½è‡³å°‘2å°æ™‚ï¼ˆæœ€å¥½éå¤œï¼‰\n3. é ç†±çƒ¤ç®±ï¼šå°‡çƒ¤ç®±é ç†±è‡³ {temperature}Â°C\n4. çƒ˜çƒ¤æ™‚é–“ï¼šå°‡é›è‚‰æ”¾å…¥çƒ¤ç®±ï¼Œçƒ˜çƒ¤ {time} åˆ†é˜\n5. æª¢æŸ¥ç†Ÿåº¦ï¼šä½¿ç”¨æº«åº¦è¨ˆæª¢æŸ¥é›è‚‰å…§éƒ¨æº«åº¦æ˜¯å¦é”åˆ°74Â°C\n6. éœç½®ä¼‘æ¯ï¼šçƒ˜çƒ¤å®Œæˆå¾Œï¼Œè®“é›è‚‰éœç½®10åˆ†é˜å†åˆ‡å¡Šäº«ç”¨"
                instructions_result.text = instructions
                
                # ä¿å­˜åˆ°å†å²è®°å½•
                save_to_history(weight, temperature, time, marinade_data, current_recipe)
                
            except ValueError:
                error_message.style.display = "block"
        
        # æŒ‰é’®äº‹ä»¶å¤„ç†
        def start_handler(evt):
            window.alert("é–‹å§‹çƒ˜çƒ¤åŠŸèƒ½")
        
        def temp_handler(evt):
            window.alert("æº«åº¦èª¿æ•´åŠŸèƒ½")
        
        def timer_handler(evt):
            window.alert("è¨ˆæ™‚å™¨è¨­å®šåŠŸèƒ½")
        
        def recipe_handler(evt):
            window.alert("é£Ÿè­œæŸ¥çœ‹åŠŸèƒ½")
        
        def history_handler(evt):
            show_history_view()
        
        def back_handler(evt):
            show_main_view()
        
        # é…æ–¹é€‰æ‹©äº‹ä»¶
        def classic_handler(evt):
            set_active_recipe("classic")
        
        def spicy_handler(evt):
            set_active_recipe("spicy")
        
        def herbal_handler(evt):
            set_active_recipe("herbal")
        
        def sweet_handler(evt):
            set_active_recipe("sweet")
        
        # å›¾æ ‡ç‚¹å‡»äº‹ä»¶
        def monitor_handler(evt):
            show_main_view()
            window.alert("é€²å…¥ç›£æ§æ¨¡å¼")
        
        def recipe_icon_handler(evt):
            set_active_icon(icon_recipe)
            window.alert("é€²å…¥é£Ÿè­œç®¡ç†")
        
        def history_icon_handler(evt):
            show_history_view()
        
        def settings_handler(evt):
            set_active_icon(icon_settings)
            window.alert("é€²å…¥ç³»çµ±è¨­å®š")
        
        # ç»‘å®šäº‹ä»¶
        calculate_btn.bind("click", calculate_handler)
        document["start-btn"].bind("click", start_handler)
        document["temp-btn"].bind("click", temp_handler)
        document["timer-btn"].bind("click", timer_handler)
        document["recipe-btn"].bind("click", recipe_handler)
        history_btn.bind("click", history_handler)
        back_btn.bind("click", back_handler)
        
        # é…æ–¹äº‹ä»¶ç»‘å®š
        recipe_classic.bind("click", classic_handler)
        recipe_spicy.bind("click", spicy_handler)
        recipe_herbal.bind("click", herbal_handler)
        recipe_sweet.bind("click", sweet_handler)
        
        # å›¾æ ‡äº‹ä»¶ç»‘å®š
        icon_monitor.bind("click", monitor_handler)
        icon_recipe.bind("click", recipe_icon_handler)
        icon_history.bind("click", history_icon_handler)
        icon_settings.bind("click", settings_handler)
        
        # åˆå§‹åŒ–åº”ç”¨
        def initialize():
            update_time()
            load_from_history()
            # è®¾ç½®å®šæ—¶å™¨
            timer.set_interval(update_time, 30000)  # æ¯30ç§’æ›´æ–°æ—¶é—´
        
        # å¯åŠ¨åº”ç”¨
        initialize()
    </script>
</body>
</html>